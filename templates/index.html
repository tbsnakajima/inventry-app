<!DOCTYPE html>
<html>
<head>
    <title>在庫管理</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>

    <h3>新しい商品を追加</h3>
<form id="add-item-form">
    <input type="text" name="item_name" placeholder="商品名" required>
    <input type="text" name="category" placeholder="カテゴリー">
    <input type="text" name="unit" placeholder="単位">
    <input type="number" name="reorder_point" placeholder="発注点" min="0">
    <input type="number" name="standard_price" placeholder="標準単価" step="0.01">
    <button type="submit">追加</button>
</form>

<script>
document.getElementById('add-item-form').addEventListener('submit', function(e){
    e.preventDefault();
    const form = e.target;
    const data = {
        item_name: form.item_name.value,
        category: form.category.value,
        unit: form.unit.value,
        reorder_point: parseInt(form.reorder_point.value) || 0,
        standard_price: parseFloat(form.standard_price.value) || 0
    };
    axios.post('/item/add', data)
        .then(res => {
            if(res.data.status === "ok"){
                alert("商品追加成功");
                form.reset();
                loadStock();  // 在庫一覧更新
            }
        });
});
</script>


<h1>在庫管理</h1>

<table border="1">
    <thead>
        <tr>
            <th>品目</th>
            <th>カテゴリー</th>
            <th>数量</th>
            <th>単位</th>
            <th>発注フラグ</th>
            <th>入庫</th>
            <th>出庫</th>
        </tr>
    </thead>
    <tbody id="stock-table">
        <!-- JSで埋め込み -->
    </tbody>
</table>

<script>
function loadStock() {
    axios.get('/stock')
    .then(res => {
        const tbody = document.getElementById('stock-table');
        tbody.innerHTML = '';
        res.data.forEach(row => {
            tbody.innerHTML += `
                <tr>
                    <td>${row.item_name}</td>
                    <td>${row.category}</td>
                    <td>${row.quantity}</td>
                    <td>${row.unit}</td>
                    <td>${row.reorder_flag ? "⚠ 発注" : ""}</td>
                    <td><button onclick="stockIn(${row.inventory_id})">入庫</button></td>
                    <td><button onclick="stockOut(${row.inventory_id})">出庫</button></td>
                </tr>
            `;
        });
    });
}


function stockIn(inventory_id) {
    const qty = parseInt(prompt("入庫数量を入力してください", "1"));
    if (!qty) return;

    axios.post('/stock/in', { inventory_id: inventory_id, qty: qty })
    .then(res => {
        alert("入庫完了");
        loadStock();
    })
    .catch(err => alert(err));
}

function stockOut(inventory_id) {
    const qty = parseInt(prompt("出庫数量を入力してください", "1"));
    if (!qty) return;

    axios.post('/stock/out', { inventory_id: inventory_id, qty: qty })
    .then(res => {
        alert("出庫完了");
        loadStock();
    })
    .catch(err => alert(err));
}

// 初回ロード
loadStock();
</script>

